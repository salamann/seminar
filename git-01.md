# Gitを使ってみよう(その２) - ブランチとマージ

今回は Git の旨味の部分を実際の利用例をあげて説明します。

## そもそもブランチの使い道って？

* 作業用のテンポラリ
	* 時間のかかる変更をローカルでコミットしながらができる
	* やりたければ作業用ブランチを他人と共有することもできる
* リリースブランチと開発ブランチ
	* 提出版を作るのでコミットはやめてと言う必要がない
* カスタム版を作りたい(オリジナルの変更も反映しながら)
	* 社内ライブラリのプロジェクト専用版
	* オープンソースソフトウェアの社内カスタム版

## Subversion のリビジョンとブランチ

* リビジョンは直線的に並んでいて、明示的なブランチ(分岐)という概念はない
* コピーされたディレクトリをブランチとして扱っているだけ

![svnのブランチ](https://github.com/shunichi/seminar/raw/seminar02/images/svn-branch.png)

* ブランチの概念があいまいなのでマージは苦手

![svnのリビジョン](https://github.com/shunichi/seminar/raw/seminar02/images/svn-revisions.png)

## Git のリビジョンとブランチ

* リビジョン(コミット)が分岐したり合流したりするため、本当のブランチがある
* ブランチはリビジョンの枝の先端につけられた印

![Gitのブランチ](https://github.com/shunichi/seminar/raw/seminar02/images/git-branch.png)

* ブランチの関係がはっきりしているのでマージがうまくいきやすい

![Gitのリビジョン](https://github.com/shunichi/seminar/raw/seminar02/images/git-revisions.png)

* 中央リポジトリ(共有リポジトリ)にすべてのブランチがあるわけではない(ローカルリポジトリのブランチは push しなければ、中央リポジトリには伝わりません)

## フィーチャーブランチ(トピックブランチ)

Gitではブランチとマージが手軽にできるため、細かくブランチを作ることがよくあります。
例えば、一つのバグ修正や一つの新機能の実装作業ごとにブランチを作ります。

![フィーチャーブランチ](https://github.com/shunichi/seminar/raw/seminar02/images/git-feature-branch.png)

Subversion ではあまり細かいブランチを作成せずに trunk で作業することが多く、コミットは開発者全員に影響してしまいます。何日もかかる作業の途中では正しく動作しないソースやコンパイルすら通らないソースがあるため、コミットすることはできません。

Git では、機能ごとのブランチをローカルリポジトリに作ることで、中途半端なソースファイルをコミットしながら作業することができます。新機能の開発中に既存機能のバグ修正作業が必要になった場合には、新たなバグ修正ブランチを作って作業すれば、それぞれの作業同士が干渉することはありません。

トピックブランチでの変更は最終的には開発の本線ブランチにマージされ、他の開発者に伝わります。

## リリースブランチと開発ブランチ

Subversion での開発では、重要なリリース(クライアントへの提出版など)の直前にコミットを禁止期間をもうけることがあります。

Git では、リリース(準備用)ブランチを作ることで、リリースのための作業をしつつ、そのリリースとは関係ない将来のための作業を同時に行うことができます。

![リリースブランチ](https://github.com/shunichi/seminar/raw/seminar02/images/git-release-branch.png)

リリースブランチで行ったバグ修正などは、開発用の本線ブランチにも適宜マージします。

## カスタム版をつくって維持する

社内ライブラリの特定チーム専用カスタマイズや、オープンソースソフトウェアの社内用カスタマイズをしたい場合はたまにあります。カスタマイズをした後にオリジナルのバグ修正や機能追加があった場合、カスタマイズ版にもそれらを取り込みたいところですが、 Subversion でそれをやるのは骨が折れます。

Git では、オリジナルでの変更を追従するだけのブランチと、カスタマイズ用変更だけをコミットするブランチを別々に作ることで、カスタムとオリジナルへの追従の両立が容易になります。

## まとめ

* Gitではブランチの構造がわかりやすいので気軽にブランチを作っても大丈夫
* ブランチを使うといろいろ楽になる

## 参考

* [Pro Git (3. Gitのブランチ機能)](http://git-scm.com/book/ja/Git-%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E6%A9%9F%E8%83%BD)
* [A successful Git branching model(日本語訳)](http://keijinsonyaban.blogspot.jp/2010/10/successful-git-branching-model.html)
* [図解 Git](http://marklodato.github.com/visual-git-guide/index-ja.html)
